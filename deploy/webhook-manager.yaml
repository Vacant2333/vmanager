apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: vmanager-webhook-manager
  name: vmanager-webhook-manager
  namespace: vmanager
spec:
  replicas: 1
  selector:
    matchLabels:
      app: vmanager-webhook-manager
  template:
    metadata:
      labels:
        app: vmanager-webhook-manager
    spec:
      serviceAccountName: all-powerful-sa
      containers:
        - name: webhook-manager
          args:
            - --cert-dir=/var/serving-cert
            - -v=5
          image: vacantsh/webhook-manager:1.0
          imagePullPolicy: Never
          volumeMounts:
            - mountPath: /var/serving-cert
              name: admission-certs
              readOnly: true
      volumes:
        - name: admission-certs
          secret:
            secretName: vmanager-webhook-cert
---
apiVersion: v1
kind: Service
metadata:
  name: vmanager-webhook
  namespace: vmanager
  labels:
    app: vmanager-webhook-manager
spec:
  ports:
    - port: 443
      protocol: TCP
      targetPort: 8443
  selector:
    app: vmanager-webhook-manager
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: all-powerful-sa
  namespace: vmanager
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: all-access-cluster-role
rules:
  - apiGroups: ["*"]
    resources: ["*"]
    verbs: ["*"]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: all-access-cluster-role-binding
subjects:
  - kind: ServiceAccount
    name: all-powerful-sa
    namespace: vmanager
roleRef:
  kind: ClusterRole
  name: all-access-cluster-role
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: v1
data:
  ca.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURNVENDQWhtZ0F3SUJBZ0lVSG1KODZpaVBQdGMyLzkzR0NRVnpTNmNMa01Bd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0tERW1NQ1FHQTFVRUF3d2RkbTFoYm1GblpYSXRkMlZpYUc5dmF5NTJiV0Z1WVdkbGNpNXpkbU13SGhjTgpNalF3TnpJMU1UY3hOekU0V2hjTk16UXdOekl6TVRjeE56RTRXakFvTVNZd0pBWURWUVFEREIxMmJXRnVZV2RsCmNpMTNaV0pvYjI5ckxuWnRZVzVoWjJWeUxuTjJZekNDQVNJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0MKQVFvQ2dnRUJBUEFpUnBsU3h4SVlqMThYWmpjVWdwVmFzUmZBWnNLcGhSUStjYm9QOXNYVU9XMGdlNGhyZjJ4RApERVRPbFdVVUcybENGUnpKSHpzMm1RZlpJdjdTSzNmQm93TDR6cXVqWW11ZjFPODNlTVdtSkxHY29nU1dTdFhZCmphc0FHU2thWTduTFBBdy9SMk81cytDRUNvNllMSkR2K29hb3oxN3B2ejl5OVpVZk8yaXB3ZkRvYzhIZWdiSE4Kd284WjViSi90VWpKb25yZTlEbkdlWEg5N2w3WnJWTUFZUFVvdmlpcGpqYk05UHBlNU1ucW1CU1hCemVydlVXdAppNFBwWnViMlUwWDVjYVBNNkFVSXM5b3pBa0REVUMvK0x4Ym1aUDBoMjJMdnhtMm02clNBK3dKZUIrK25GTVlwCkZqWWhYYnBtSjlyZVhDeDlnajRDMW9HY2NLSmVuREVDQXdFQUFhTlRNRkV3SFFZRFZSME9CQllFRkdTMUlnOVgKSjhRdjU3S0FyZE03Uyt6ZDhBMVlNQjhHQTFVZEl3UVlNQmFBRkdTMUlnOVhKOFF2NTdLQXJkTTdTK3pkOEExWQpNQThHQTFVZEV3RUIvd1FGTUFNQkFmOHdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBQVpkVHp1UVU4emJxbmk1CjdZYTZZSCtIZ3pSSTdIYVEzUTlrUUJ2c2pScmRBMW40dlpObmFST29MeGlZTkc3QXRzNG9iOGs3TFhJYVZZUnEKVTg5amphZ2drc1hXdkRiWTJVYm5sQVlveG1sbDNMcnVpNjlLK2hES2dkL0ozUmo1VGNITzk5TmFacFk3NHQ4UAoxaTRxTHFld3JJRXpXc0E3ZUJLVHhEN0FxbGtWZ1BRenBhRytCMllQQzI5OGpJY3Vhb2lkOUtpNnIvcGt1WTZ6Cis3YnRFeS9OYlNOa0VwZVcxc291TkVZci9nVG85bnFvbytTRkhGbitsdW54R0Q3WGpnbXVtb3F1bXUwSkJHUDEKZTcyZkdSM3ZoNnc3QmZJMVJCUjZGSmxZOU9KODJKbjBCc1FKYTJIMjVRWkF5SEFWWUtPV3RKQUVpVlRic0JGZwpmU1NsVkY4PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURwakNDQW82Z0F3SUJBZ0lVZFdGUDZQT2NpT2MwZHZpTi82ZEpYYTU0YnVvd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0tERW1NQ1FHQTFVRUF3d2RkbTFoYm1GblpYSXRkMlZpYUc5dmF5NTJiV0Z1WVdkbGNpNXpkbU13SGhjTgpNalF3TnpJMU1UY3hOekU0V2hjTk16UXdOekl6TVRjeE56RTRXakFvTVNZd0pBWURWUVFEREIxMmJXRnVZV2RsCmNpMTNaV0pvYjI5ckxuWnRZVzVoWjJWeUxuTjJZekNDQVNJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0MKQVFvQ2dnRUJBSTZpQ25BbFNWQzhUK05Sem1NbGwvSGtXMng2QUpHUFk2R1VjWm9YRWJqWGVleHJucWtoOUFTagpUZEVQb25SQWhHNm9QMUUrWmRqMUxsM0xmU294by9QekJ0NXplSSs4V0ZKQ2lrTG5rRUZJb1p6TGw3SDE1UjcrClRVMFRobk1JclMvQVBXdE5leW10ZEx6MVdERWc4WUg0RnNyV2J6SmN0ZW9aeHoyQTY5UG1GQ1hSN2x3NnU2akQKUGhHbkEwckNld1NpMVh6dGVwSVpCT2JRdGhhMTBJY0hVZWdqeW9TSUlGQXF5cFk5Q3VZWXA0ZDVMRWRKdWVYTgpQZnRHRUhzNEVLOXdJK2dYYi9LUzNaU29oOUFxYnQ5RCtSOVM1bUlyZytHU0tnQlJBNExZTWNnd0duMXFUeWFMCnB2Qyt1WWtzdFBUWmlXMzk0bEEydzBNOFN5MUdkcDhDQXdFQUFhT0J4ekNCeERBSkJnTlZIUk1FQWpBQU1Bc0cKQTFVZER3UUVBd0lGNERBVEJnTlZIU1VFRERBS0JnZ3JCZ0VGQlFjREFUQlZCZ05WSFJFRVRqQk1naEIyYldGdQpZV2RsY2kxM1pXSm9iMjlyZ2hsMmJXRnVZV2RsY2kxM1pXSm9iMjlyTG5adFlXNWhaMlZ5Z2gxMmJXRnVZV2RsCmNpMTNaV0pvYjI5ckxuWnRZVzVoWjJWeUxuTjJZekFkQmdOVkhRNEVGZ1FVSGg2R29qclFFVGtsMUczN1dLa1MKcVNySERNOHdId1lEVlIwakJCZ3dGb0FVWkxVaUQxY254Qy9uc29DdDB6dEw3TjN3RFZnd0RRWUpLb1pJaHZjTgpBUUVMQlFBRGdnRUJBTG5aanh6aHVGa1J4alJ4bUJGdm5aaVVhUlVwb3pXZHkwa1gvM2hnR1FCWlppU3l4RmRTCmlWNldQYzc2LzQ4YkhvTWJaUk9lNERVSVpvUkdXdVNUaEVGcUNFVDBNMEtrNFVwdGZZL01nUkVqRGk0OTkvb2cKWXd0VEFkd2ExaXJUZEtRNkgwbE9sWXNteFVTRmZRRU4rWXE0ZTV5TVdwS1hXU1c2djVvMFVHcHRrMDg5VitKQQpBdjQxL0owTEcyYUlSWk1vbHNzSWxyTnJPOEt0M3NQak5yMENEeXR2Ri9xTFBjZk1Wd0pER2pGVmVROUVnV3o3ClE1ZWw0S3ZvN091ajkrZ2pXZ1BFVXZqWmZuZ0ViZjhEQ1N4UXBWWmdGeVBreGVRRVRSalF6cGFhaDVvdFk4N3EKSFlZNmxDWVlndlRid0lQRFZLRUtNRUdaWXlrVHFxRzhjdUk9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  tls.key: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2UUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktjd2dnU2pBZ0VBQW9JQkFRQ09vZ3B3SlVsUXZFL2oKVWM1akpaZng1RnRzZWdDUmoyT2hsSEdhRnhHNDEzbnNhNTZwSWZRRW8wM1JENkowUUlSdXFEOVJQbVhZOVM1ZAp5MzBxTWFQejh3YmVjM2lQdkZoU1FvcEM1NUJCU0tHY3k1ZXg5ZVVlL2sxTkU0WnpDSzB2d0QxclRYc3ByWFM4CjlWZ3hJUEdCK0JiSzFtOHlYTFhxR2NjOWdPdlQ1aFFsMGU1Y09ydW93ejRScHdOS3duc0VvdFY4N1hxU0dRVG0KMExZV3RkQ0hCMUhvSThxRWlDQlFLc3FXUFFybUdLZUhlU3hIU2JubHpUMzdSaEI3T0JDdmNDUG9GMi95a3QyVQpxSWZRS203ZlEva2ZVdVppSzRQaGtpb0FVUU9DMkRISU1CcDlhazhtaTZid3ZybUpMTFQwMllsdC9lSlFOc05EClBFc3RSbmFmQWdNQkFBRUNnZ0VBSUJLK0NDUEtUYlphdklJN3g3Mi9ZaXg0aG5jVXc2YWJ2OHpTa3RUWExscDkKMXpVSUUzNUlFZmJxMjdVSlVkemtLc0g0b3Z0R0NiaHdlYlQxYTFTSVNxWCtpRzBzMGgySE90QXRxUWZMUDNMbQpySXgzaXhRQk5xdjJrL3R0QTFjVElxYTI2UGNlVit2aVVVOVdTbzNlNE52NXZCam1Ia3dNdUJ5ZDJlMndtaEJQCnpSZGVXMytkemE2UGpBVmttTjE3YzRISWRBZFBJci9ZUkZYSkR6aGgxQUJsT3g1eG9WbTZya1BBcE5UdzNrdUgKMlZTZ1p1TktNU29QTVNMYm9ieG9CQWNZbkhlSkMzVjROMkIzVUkxdnB5aGRUb3F6T08zRDJpSmNmVUd2VTV6YgpZUTNtTlBZcVFNbXBHdGgwQkxlcitDTHpENUMrdUhiVkYrK1hOZGJ1Y1FLQmdRQy9yb1lKQkJPQWJPN3hCdVJPClgxcnJxaldObVljUitCdDQyRWhlby9zZit2VDZRdm1UYUY3UVJhanRUbVg0d3h1S1FGM0ZQL0QzcURnSmY1ZjMKYkxxeXh1OHYra3VQbVg2MVk1WHRCWWhGbGlTSXFuNy9MQ1BWaVdkWkxpZ1JUNjBjTk0zblRjNmxSZWJxSmJmQQoxVDA2ZkI3VmJsVWFEb2lEeU0rblc4aXc2UUtCZ1FDK2ZqbUNZZmZzbXpWZUVyZTNwSEVPZWVaRnIzYlNVbWRqCnlYK1VZdW5yMUJzM0REdndORVF6NnNlbGNIWVhxQmorSWk5VStKWWx0OEFiRlQyeFRpTWxHTUpUdlNlRXBUREsKV3Rza3hWL1JJalgvRjkvRmxqYjhtb1dOWUFLdk9vTmRkWjh2a3o0NFRoNWErL1BMeHlMVlR5VGErSVhweDRpcQpEZ2lHNDBKMlJ3S0JnUUNTL25HSFpIcllGN0c5WUwyZ1pIdkRFZ3B6aG5NUWtxWHVyRjREUmRtRkV0emZOcEZTCk84M0tCa0dmaW1ta3RXcmZRTEVvWFBxYjBZTDN0Y09DV1AxcnNDY3BNZGJVVHEvZXhubnBCRDhXcmlkaUx1MnAKSGQ1MUdTUUtQZDA0T1ZQVnQ2RFhhdEczNkwxR2ZwcEY1TUZKb25tNnp4dXdHY2tTMXVKM3cybEtVUUtCZ0dwagpvTWJhNUZaMjBMVjdpck83MlpDV01DOVhNZXVCTGxFaTVtZi9YbG5obWxtQ01hK1Q0VXVGb244WmNqc0FIUVZDCkhtRThmTThQOHZDdFNrbE9OSDZ4ZDBiQmErSy9SNktjWDZ3SHQ5M2JWNERpMm8xRnVld1dlT1JlYk9Ga3NwMXQKNWJ2eVpsdVg5WWduRXlBS1ZjQUFkYnI5OWZ4OC9pekxyYU40SlZSZEFvR0FOZVBTUTkyZ0FGdUJuRXJodU1aRgpPRkdRYUZ1aEwwc2JZV04xOHpjN1o5R3BSV2VjK0lKZWlyYTI0MWdzTk9JdThINnNQcFdHWHdHU2FaeXBvVU90CnhWR2hKNWpaZ0NMY2NYUEswTGNXenBwaERkSEVOcmJraDJudm82VWpxUmJVR2lZK2pEVURJMGxRYXZTWXY0bXIKU0dwVmtuR2pFcVUvWksyQzltWnViUFk9Ci0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K
kind: Secret
metadata:
  name: vmanager-webhook-cert
  namespace: vmanager
type: Opaque
